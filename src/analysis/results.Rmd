---
title: "Data Analysis"
author: "Team 5"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    df_print: paged
  pdf_document: default
---
<style>
body {
  color: #444444;
  font-family: Calibri;
  font-size: 12pt;
  background-color: #F5F5F5;
}
pre {
  color: #708090;
  background-color: #F8F8FF;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align = "center", echo = TRUE)
```

```{r loading_data, include = FALSE, echo = FALSE}
library(dplyr)
library(tidyverse)
library(readr)
library(ggplot2)
library(tidyr)
library(car)
library(knitr)
library(table1)
library(kableExtra)
library(broom)
library(sm)
ListingsCovid <- read.csv("../../gen/temp/merged_data.csv")

```

### Summary of the Merged data
`merged_data` contains listings of 17 analyzed European cities. It captures around 200,000 observations in total, and not every city has the same number of listings as one another. Below is an overview of the first few rows and columns of the `merged_data`

### Histogram of avg_price(both with and without log function)

```{r distribution of price by country, echo = FALSE, warning = FALSE}
ggplot(ListingsCovid, aes(avg_price)) + geom_histogram(bin = 30) + scale_x_log10()
```

###Scatterplot of Price per weekly count

```{r echo = FALSE, warning = FALSE}
ggplot(ListingsCovid,
       aes(x = weekly_count, y = avg_price, color = country_code)) +
  geom_point() +
  scale_y_log10()
```

###scatterplot of Price per weekly count by country code

```{r Price per weekly count by country code, echo = FALSE, warning = FALSE}
ggplot(ListingsCovid,
       aes(x = weekly_count, y = avg_price, color = country_code)) +
  geom_point() +
  scale_y_log10() +
  labs(title = "Price per weekly count by country code") +
  facet_wrap(~ country_code)
```

###Simple regression with DV Log avg_price and IV weekly_count

```{r simple regression, echo = FALSE, warning = FALSE}

lm(log_price ~ weekly_count, ListingsCovid)%>%
  tidy() %>%
  kable(
    caption = "Model 1: Simple Regression",
    align = c("l", "c", "c", "c", "c"),
    col.names = c(" ", "Estimate", "Std. Error", "T value", "p.value"),
    digits = c(0, 4, 4, 2, 4)
  )
```

###Regression with other characteristics of listings

```{r Regression Analysis Model 1, echo = FALSE, warning = FALSE}
  lm(log_price ~ weekly_count +
      room_type + minimum_nights +
      reviews_per_month +
      number_of_reviews_ltm +
      availability_365,
    ListingsCovid
  )%>%
  tidy() %>%
  kable(
    caption = "Model 2: Multi Regression",
    align = c("l", "c", "c", "c", "c"),
    col.names = c(" ", "Estimate", "Std. Error", "T value", "p.value"),
    digits = c(0, 4, 4, 2, 4)
  )
```

# check multicollinearity

```{r checking multicollinearity of Model 1, echo = FALSE, warning = FALSE}
# 1vif(ListingsCovid_lm1)
```

# check heteroskedasticity

```{r checking heteroskedasticity of Model 1, echo = FALSE, warning = FALSE}
# residuals_lm1 <- ListingsCovid_plot1$residuals
# ggplot(ListingsCovid, aes(x = weekly_count, y = residuals_lm1)) + geom_point()
```

## Regression with added interactions between weekly count and room type

```{r Regression Analysis Model 2, echo = FALSE, warning = FALSE}
 ListingsCovid_lm2<-lm(
  log_price ~ weekly_count * room_type +
    minimum_nights +
    reviews_per_month +
    number_of_reviews_ltm +
    availability_365,
  ListingsCovid
)%>%
  tidy() %>%
  kable(
    caption = "Model 3: Muliple Regression with Interactions",
    align = c("l", "c", "c", "c", "c"),
    col.names = c(" ", "Estimate", "Std. Error", "T value", "p.value"),
    digits = c(0, 4, 4, 2, 4)
  )
print(ListingsCovid_lm2)
```

# check multicollinearity

```{r checking multicollinearity of Model 2, echo = FALSE, warning = FALSE}
#vif(ListingsCovid_lm2)
```

# check heteroskedasticity

```{r checking heteroskedasticity of Model 2, echo = FALSE, warning = FALSE}
# residuals_lm2 <- ListingsCovid_lm2$residuals
# ggplot(ListingsCovid, aes(x = weekly_count, y = residuals_lm2)) + geom_point()
```

